
<!-- Image section -->

<div class="text-center p-3">
<h1>Welcome to the TELAMON Database!</h1>
<h2>Tev Effelsberg Long-term Agn MONitoring</h2>
</br>
<%= image_tag("telescope", width: 650) %>
</br>
</div>

<div class="text-center p-3">
<%= link_to "Overview of monitored sources", sources_path %>
</br>
<%= link_to "Overview of observing epochs", epoches_path %>
</br>
</div>



<!-- Latest news section -->
<div class="card">
  <div class="card-header">
    Latest news
  </div>
  <div class="card-body">
    <h5 class="card-title">Last observation on <%= @epoches.order("date").reverse.first.date %>:</h5>

    <!-- checking for surprising changes in most recent epoch -->
    <% latest_epoch = @epoches.order("date").reverse.first %>
    <% latest_epoch.sources.distinct.each do |source| %>
    	<% epoch_before = source.epoches.distinct.order("date").reverse.second %>
    	<% if(epoch_before != nil) %>
    		<% source.frequencies.distinct.each do |freq| %>
    			<% value_now = @results.where(:epoch_id => latest_epoch.id, :frequency_id => freq.id, :source_id => source.id).average(:value_jy)%>
    			<% value_before = @results.where(:epoch_id => epoch_before.id, :frequency_id => freq.id, :source_id => source.id).average(:value_jy)%>
          <%if value_before != nil and value_now != nil %>
            <% if value_now>1.1*value_before %>
            <%= source.j2000_name %> got brighter by <%= 100*(value_now/value_before-1).round(2)%>%</br>
            <% elsif value_now<0.9*value_before%>
            <%= source.j2000_name %> got fainter by <%= 100*(1-value_now/value_before).round(2)%>%</br>
            <%end%>
          <%end%>
    		<%end%>
    	<% else %>
    		<%= source.j2000_name %> detected for the first time!</br>
    	<%end%>
    <%end%>
  </div>
</div>







